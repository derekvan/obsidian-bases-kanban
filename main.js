/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var D=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var N=(u,n)=>{for(var t in n)D(u,t,{get:n[t],enumerable:!0})},O=(u,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of M(n))!A.call(u,e)&&e!==t&&D(u,e,{get:()=>n[e],enumerable:!(r=x(n,e))||r.enumerable});return u};var F=u=>O(D({},"__esModule",{value:!0}),u);var V={};N(V,{default:()=>E});module.exports=F(V);var I=require("obsidian");var i=require("obsidian");var B=require("obsidian"),y=class{constructor(n,t){this.dragState=null;this.dropIndicator=null;this.boardEl=null;this.app=n,this.callbacks=t}initBoard(n){this.boardEl=n,this.createDropIndicator()}destroy(){var n;(n=this.dropIndicator)==null||n.remove(),this.dropIndicator=null,this.boardEl=null,this.dragState=null}createDropIndicator(){this.dropIndicator=document.createElement("div"),this.dropIndicator.className="bases-kanban-drop-indicator"}makeColumnDraggable(n,t,r){let e=n.querySelector(".bases-kanban-column-header");e&&(e.setAttribute("draggable","true"),e.classList.add("bases-kanban-draggable"),e.addEventListener("dragstart",a=>this.handleColumnDragStart(a,n,t,r)),e.addEventListener("dragend",a=>this.handleDragEnd(a)),n.addEventListener("dragover",a=>this.handleColumnDragOver(a,n,t,r)),n.addEventListener("dragleave",a=>this.handleDragLeave(a,n)),n.addEventListener("drop",a=>this.handleColumnDrop(a,t,r)))}makeCardDraggable(n,t,r,e){n.setAttribute("draggable","true"),n.classList.add("bases-kanban-draggable"),n.addEventListener("dragstart",a=>this.handleCardDragStart(a,n,t,r,e)),n.addEventListener("dragend",a=>this.handleDragEnd(a)),n.addEventListener("dragover",a=>this.handleCardDragOver(a,n,r,e)),n.addEventListener("drop",a=>this.handleCardDrop(a,r,e))}setupCardsDropZone(n,t){n.addEventListener("dragover",r=>this.handleCardsContainerDragOver(r,n,t)),n.addEventListener("dragleave",r=>this.handleDragLeave(r,n)),n.addEventListener("drop",r=>this.handleCardsContainerDrop(r,t))}handleColumnDragStart(n,t,r,e){n.dataTransfer&&(this.dragState={type:"column",sourceColumnName:r,sourceIndex:e,element:t},n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",`column:${r}`),requestAnimationFrame(()=>{t.classList.add("bases-kanban-dragging")}))}handleColumnDragOver(n,t,r,e){if(!this.dragState||this.dragState.type!=="column"||this.dragState.sourceColumnName===r)return;n.preventDefault(),n.stopPropagation(),n.dataTransfer&&(n.dataTransfer.dropEffect="move");let a=t.getBoundingClientRect(),s=a.left+a.width/2,o=n.clientX<s;this.showColumnDropIndicator(t,o),t.classList.add("bases-kanban-drag-over")}handleColumnDrop(n,t,r){if(n.preventDefault(),n.stopPropagation(),!this.dragState||this.dragState.type!=="column"||this.dragState.sourceColumnName===t)return;let e=this.callbacks.getColumnNames(),a=e.indexOf(this.dragState.sourceColumnName);if(a===-1)return;let o=n.currentTarget.getBoundingClientRect(),l=n.clientX<o.left+o.width/2,c=e.indexOf(t);!l&&c<e.length&&c++;let p=[...e],[d]=p.splice(a,1);a<c&&c--,p.splice(c,0,d),this.callbacks.onColumnReorder(p),this.clearDragState()}handleCardDragStart(n,t,r,e,a){n.dataTransfer&&(n.stopPropagation(),this.dragState={type:"card",sourceColumnName:e,sourceIndex:a,element:t,entry:r,filePath:r.file.path},n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",`card:${r.file.path}`),requestAnimationFrame(()=>{t.classList.add("bases-kanban-dragging")}))}handleCardDragOver(n,t,r,e){if(!this.dragState||this.dragState.type!=="card")return;n.preventDefault(),n.stopPropagation(),n.dataTransfer&&(n.dataTransfer.dropEffect="move");let a=t.getBoundingClientRect(),s=a.top+a.height/2,o=n.clientY<s;this.showCardDropIndicator(t,o)}handleCardDrop(n,t,r){if(n.preventDefault(),n.stopPropagation(),!this.dragState||this.dragState.type!=="card")return;let{entry:e,sourceColumnName:a,sourceIndex:s}=this.dragState;if(!e)return;let l=n.currentTarget.getBoundingClientRect(),c=n.clientY<l.top+l.height/2,p=r;c||p++,this.processCardDrop(e,a,t,s,p),this.clearDragState()}handleCardsContainerDragOver(n,t,r){if(!this.dragState||this.dragState.type!=="card")return;n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.target.closest(".bases-kanban-card")||(t.classList.add("bases-kanban-drop-zone-active"),this.showCardDropIndicatorAtEnd(t))}handleCardsContainerDrop(n,t){if(n.preventDefault(),!this.dragState||this.dragState.type!=="card")return;let{entry:r,sourceColumnName:e,sourceIndex:a}=this.dragState;if(!r)return;let o=n.currentTarget.querySelectorAll(".bases-kanban-card").length;this.processCardDrop(r,e,t,a,o),this.clearDragState()}async processCardDrop(n,t,r,e,a){let s=this.callbacks.getGroupByProperty(),o=this.callbacks.getSortProperty();if(t!==r){if(!s){new B.Notice("Could not detect the group by property for drag and drop");return}let l=r==="(No value)"?"":r;await this.callbacks.onCardMoveToColumn(n.file,l)}else if(o&&e!==a){let l=a;e<a&&l--,await this.callbacks.onCardReorder(n.file,r,l)}}showColumnDropIndicator(n,t){if(!this.dropIndicator||!this.boardEl)return;this.dropIndicator.className="bases-kanban-drop-indicator bases-kanban-drop-indicator-column is-visible";let r=n.getBoundingClientRect(),e=this.boardEl.getBoundingClientRect(),a=t?`${r.left-e.left-4}px`:`${r.right-e.left-4}px`;this.dropIndicator.setCssProps({"--indicator-height":`${r.height}px`,"--indicator-top":`${r.top-e.top}px`,"--indicator-left":a}),this.boardEl.appendChild(this.dropIndicator)}showCardDropIndicator(n,t){var s,o;if(!this.dropIndicator)return;this.dropIndicator.className="bases-kanban-drop-indicator bases-kanban-drop-indicator-card is-visible";let r=n.getBoundingClientRect(),e=(s=n.parentElement)==null?void 0:s.getBoundingClientRect();if(!e)return;let a=t?`${r.top-e.top-4}px`:`${r.bottom-e.top}px`;this.dropIndicator.setCssProps({"--indicator-width":`${r.width}px`,"--indicator-left":`${r.left-e.left}px`,"--indicator-top":a}),(o=n.parentElement)==null||o.appendChild(this.dropIndicator)}showCardDropIndicatorAtEnd(n){if(!this.dropIndicator)return;this.dropIndicator.className="bases-kanban-drop-indicator bases-kanban-drop-indicator-card is-visible";let t=n.getBoundingClientRect(),r=n.querySelector(".bases-kanban-card:last-child"),e="8px";r&&(e=`${r.getBoundingClientRect().bottom-t.top+4}px`),this.dropIndicator.setCssProps({"--indicator-width":"calc(100% - 16px)","--indicator-left":"8px","--indicator-top":e}),n.appendChild(this.dropIndicator)}hideDropIndicator(){this.dropIndicator&&this.dropIndicator.removeClass("is-visible")}handleDragEnd(n){this.clearDragState()}handleDragLeave(n,t){let r=n.relatedTarget;r&&t.contains(r)||(t.classList.remove("bases-kanban-drag-over"),t.classList.remove("bases-kanban-drop-zone-active"),this.hideDropIndicator())}clearDragState(){var n;(n=this.dragState)!=null&&n.element&&this.dragState.element.classList.remove("bases-kanban-dragging"),this.boardEl&&(this.boardEl.querySelectorAll(".bases-kanban-drag-over").forEach(t=>{t.classList.remove("bases-kanban-drag-over")}),this.boardEl.querySelectorAll(".bases-kanban-drop-zone-active").forEach(t=>{t.classList.remove("bases-kanban-drop-zone-active")})),this.hideDropIndicator(),this.dragState=null}};var P="(No value)",H="kanban",b=class extends i.BasesView{constructor(t,r,e){super(t);this.type=H;this.groupByProperty=null;this.currentGroups=[];this.scrollEl=r,this.plugin=e,this.containerEl=r.createDiv({cls:"bases-kanban-container"}),this.dragDropManager=new y(this.app,{onColumnReorder:a=>this.handleColumnReorder(a),onCardMoveToColumn:(a,s)=>this.handleCardMoveToColumn(a,s),onCardReorder:(a,s,o)=>this.handleCardReorder(a,s,o),getColumnNames:()=>this.getCurrentColumnNames(),getGroupByProperty:()=>this.getGroupByPropertyFromConfig(),getSortProperty:()=>this.getSortPropertyFromConfig()})}onload(){}onunload(){this.dragDropManager.destroy()}focus(){this.containerEl.focus({preventScroll:!0})}onDataUpdated(){this.render()}render(){var s,o;this.containerEl.empty();let t=(o=(s=this.data)==null?void 0:s.groupedData)!=null?o:[];if(!(t.length>1||t.length===1&&t[0].key!==void 0&&!(t[0].key instanceof i.NullValue))&&t.length<=1){this.containerEl.createEl("p",{text:'Set "Group by" in the sort menu to organize cards into columns.',cls:"bases-kanban-placeholder"});return}this.groupByProperty=this.detectGroupByProperty(t);let e=this.sortGroupsByColumnOrder(t);this.currentGroups=e;let a=this.containerEl.createDiv({cls:"bases-kanban-board"});this.dragDropManager.initBoard(a),e.forEach((l,c)=>{this.renderColumn(a,l,c)}),this.renderAddColumnButton(a)}renderColumn(t,r,e){let a=t.createDiv({cls:"bases-kanban-column"}),s=this.getColumnName(r.key),o=r.key===void 0||r.key instanceof i.NullValue;a.dataset.columnName=s,a.dataset.columnIndex=String(e);let l=a.createDiv({cls:"bases-kanban-column-header"}),c=l.createDiv({cls:"bases-kanban-drag-handle"});(0,i.setIcon)(c,"grip-vertical");let p=l.createDiv({cls:"bases-kanban-header-left"}),d=p.createEl("h3",{text:s});o&&d.addClass("bases-kanban-no-value-title"),p.createEl("span",{text:`${r.entries.length}`,cls:"bases-kanban-column-count"});let h=l.createDiv({cls:"bases-kanban-header-actions"}),v=h.createEl("button",{cls:"bases-kanban-add-card-btn clickable-icon",attr:{"aria-label":"Add card"}});if((0,i.setIcon)(v,"plus"),v.addEventListener("click",m=>{m.stopPropagation(),this.handleAddCard(o?null:s)}),o&&r.entries.length>0){let m=h.createEl("button",{cls:"bases-kanban-set-property-btn clickable-icon",attr:{"aria-label":`Set property for ${r.entries.length} files`}});(0,i.setIcon)(m,"file-plus-2"),m.addEventListener("click",f=>{f.stopPropagation(),this.handleSetPropertyOnFiles(r.entries)})}this.dragDropManager.makeColumnDraggable(a,s,e);let g=a.createDiv({cls:"bases-kanban-cards"});this.dragDropManager.setupCardsDropZone(g,s),r.entries.forEach((m,f)=>{this.renderCard(g,m,s,f)})}renderAddColumnButton(t){let e=t.createDiv({cls:"bases-kanban-add-column"}).createEl("button",{cls:"bases-kanban-add-column-btn"});(0,i.setIcon)(e,"plus"),e.createSpan({text:"Add column"}),e.addEventListener("click",()=>{this.handleAddColumn()})}getColumnName(t){return t===void 0||t instanceof i.NullValue?P:t.toString()||P}renderCard(t,r,e,a){var h,v;let s=t.createDiv({cls:"bases-kanban-card"});s.dataset.filePath=r.file.path,s.dataset.columnName=e,s.dataset.cardIndex=String(a);let o=s.createDiv({cls:"bases-kanban-card-title"}),l=r.file.path;o.createEl("a",{text:r.file.basename,cls:"internal-link"}).addEventListener("click",g=>{g.preventDefault(),this.app.workspace.openLinkText(l,"",g.ctrlKey||g.metaKey)});let d=((v=(h=this.data)==null?void 0:h.properties)!=null?v:[]).filter(g=>g!=="file.name");if(d.length>0){let g=s.createDiv({cls:"bases-kanban-card-properties"});for(let m of d){let f=r.getValue(m);f===null||f instanceof i.NullValue||this.renderPropertyRow(g,m,f)}}this.dragDropManager.makeCardDraggable(s,r,e,a)}renderPropertyRow(t,r,e){let a=t.createDiv({cls:"bases-kanban-property-row"}),s=a.createSpan({cls:"bases-kanban-property-icon"}),o=this.getIconForValue(e,r);(0,i.setIcon)(s,o),a.createSpan({cls:"bases-kanban-property-value"}).setText(this.formatValue(e))}getIconForValue(t,r){if(r.startsWith("file."))switch(r.substring(5)){case"name":case"path":case"folder":return"file";case"ext":case"extension":return"file-type";case"size":return"hard-drive";case"ctime":case"mtime":case"created time":case"modified time":return"calendar";case"tags":return"tags";case"links":case"backlinks":return"link";default:return"file"}return t instanceof i.DateValue?"calendar":t instanceof i.NumberValue?"hash":t instanceof i.BooleanValue?"check-square":t instanceof i.ListValue?"list":t instanceof i.LinkValue?"link":t instanceof i.TagValue?"tag":t instanceof i.StringValue?"type":"text"}formatValue(t){return t instanceof i.ListValue?t.toString():t instanceof i.BooleanValue?t.isTruthy()?"Yes":"No":t.toString()}handleAddCard(t){new k(this.app,e=>{e&&this.createCardNote(e,t)}).open()}async createCardNote(t,r){var a,s;let e=t.endsWith(".md")?t:`${t}.md`;try{let o=this.app.workspace.getActiveFile(),l=(s=(a=o==null?void 0:o.parent)==null?void 0:a.path)!=null?s:"",c=l?`${l}/${e}`:e,p="";r!==null&&this.groupByProperty&&(p=`---
${this.groupByProperty}: ${r}
---

`);let d=await this.app.vault.create(c,p);await this.app.workspace.getLeaf().openFile(d),new i.Notice(`Created "${t}"`)}catch(o){new i.Notice(`Failed to create note: ${o}`)}}handleAddColumn(){var e,a;let t=this.groupByProperty;if(!t){new i.Notice('Could not detect the group by property. Configure "Group by" in the sort menu first.');return}new S(this.app,(a=(e=this.data)==null?void 0:e.data)!=null?a:[],(s,o)=>{!s||o.length===0||this.addColumnToFiles(t,s,o)}).open()}handleSetPropertyOnFiles(t){new T(this.app,t,(e,a)=>{!e||!a||this.setPropertyOnEntries(t,e,a)}).open()}async addColumnToFiles(t,r,e){for(let a of e)await this.app.fileManager.processFrontMatter(a.file,s=>{s[t]=r});new i.Notice(`Added "${t}: ${r}" to ${e.length} files`)}async setPropertyOnEntries(t,r,e){for(let a of t)await this.app.fileManager.processFrontMatter(a.file,s=>{s[r]=e});new i.Notice(`Set "${r}: ${e}" on ${t.length} files`)}handleColumnReorder(t){this.updateColumnOrder(t)}async handleCardMoveToColumn(t,r){let e=this.getGroupByPropertyFromConfig();if(!e){new i.Notice("Could not detect the group by property. Ensure cards have frontmatter for the grouped property.");return}await this.app.fileManager.processFrontMatter(t,a=>{r===""?delete a[e]:a[e]=r})}async handleCardReorder(t,r,e){let a=this.getSortPropertyFromConfig();if(!a)return;let s=this.currentGroups.find(d=>this.getColumnName(d.key)===r);if(!s)return;let o=s.entries.find(d=>d.file.path===t.path);if(!o)return;let l=s.entries.filter(d=>d.file.path!==t.path),c=[...l.slice(0,e),o,...l.slice(e)],p=this.getSortDirection()==="DESC";await this.renumberCardsInOrder(c,a,p)}getSortDirection(){var r,e;let t=(e=(r=this.config)==null?void 0:r.getSort())!=null?e:[];return t.length===1?t[0].direction:"ASC"}async renumberCardsInOrder(t,r,e){let a=t.length,s=t.map((o,l)=>{let c=e?a-l:l+1;return this.app.fileManager.processFrontMatter(o.file,p=>{p[r]=c})});await Promise.all(s)}getCurrentColumnNames(){return this.currentGroups.map(t=>this.getColumnName(t.key))}detectGroupByProperty(t){var c,p;let r=t.find(d=>d.hasKey()&&d.entries.length>0);if(!r||!r.key)return null;let e=r.key.toString(),a=r.entries[0],s=this.app.metadataCache.getFileCache(a.file),o=s==null?void 0:s.frontmatter;if(o)for(let[d,h]of Object.entries(o)){if(d==="position")continue;if(String(h)===e)return d}let l=(p=(c=this.data)==null?void 0:c.properties)!=null?p:[];for(let d of l){let h=a.getValue(d);if(h&&h.toString()===e&&d.startsWith("note."))return d.substring(5)}return null}getGroupByPropertyFromConfig(){return this.groupByProperty}getSortPropertyFromConfig(){var a,s;let t=(s=(a=this.config)==null?void 0:a.getSort())!=null?s:[];if(t.length!==1)return null;let e=t[0].property;return e.startsWith("note.")?e.substring(5):null}getColumnOrderFromConfig(){var r;let t=(r=this.config)==null?void 0:r.get("columnOrder");return typeof t=="string"&&t.length>0?t.split(",").map(e=>e.trim()).filter(e=>e.length>0):Array.isArray(t)?t.filter(e=>typeof e=="string"):[]}sortGroupsByColumnOrder(t){let r=this.getColumnOrderFromConfig();if(r.length===0)return t;let e=new Map(r.map((a,s)=>[a,s]));return[...t].sort((a,s)=>{var d,h;let o=this.getColumnName(a.key),l=this.getColumnName(s.key),c=(d=e.get(o))!=null?d:1/0,p=(h=e.get(l))!=null?h:1/0;return c===1/0&&p===1/0?0:c-p})}updateColumnOrder(t){var e;let r=t.join(",");(e=this.config)==null||e.set("columnOrder",r)}static getViewOptions(){return[{key:"columnOrder",displayName:"Column order",type:"text",default:"",placeholder:"Managed by drag & drop",shouldHide:()=>!0}]}},k=class extends i.Modal{constructor(n,t){super(n),this.onSubmit=t}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("bases-kanban-modal"),n.createEl("h3",{text:"Create new card"}),new i.Setting(n).setName("Note name").addText(t=>{this.inputEl=t.inputEl,t.setPlaceholder("Enter note name").onChange(()=>{})}),new i.Setting(n).addButton(t=>t.setButtonText("Create").setCta().onClick(()=>{let r=this.inputEl.value.trim();r&&(this.onSubmit(r),this.close())})).addButton(t=>t.setButtonText("Cancel").onClick(()=>this.close())),this.inputEl.focus(),this.inputEl.addEventListener("keydown",t=>{if(t.key==="Enter"){t.preventDefault();let r=this.inputEl.value.trim();r&&(this.onSubmit(r),this.close())}})}onClose(){let{contentEl:n}=this;n.empty()}},S=class extends i.Modal{constructor(t,r,e){super(t);this.selectedFiles=new Set;this.entries=r,this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("bases-kanban-modal"),t.addClass("bases-kanban-add-column-modal"),t.createEl("h3",{text:"Add new column"}),new i.Setting(t).setName("Column value").setDesc("The value to assign to selected files").addText(e=>{this.columnValueInput=e.inputEl,e.setPlaceholder("Enter column name")}),t.createEl("h4",{text:"Select files to add to this column"});let r=t.createDiv({cls:"bases-kanban-file-list"});for(let e of this.entries){let a=r.createDiv({cls:"bases-kanban-file-item"}),s=a.createEl("input",{type:"checkbox",attr:{id:`file-${e.file.path}`}});a.createEl("label",{text:e.file.basename,attr:{for:`file-${e.file.path}`}}),s.addEventListener("change",()=>{s.checked?this.selectedFiles.add(e):this.selectedFiles.delete(e)})}new i.Setting(t).addButton(e=>e.setButtonText("Create column").setCta().onClick(()=>{let a=this.columnValueInput.value.trim();a&&this.selectedFiles.size>0?(this.onSubmit(a,Array.from(this.selectedFiles)),this.close()):a?new i.Notice("Please select at least one file"):new i.Notice("Please enter a column name")})).addButton(e=>e.setButtonText("Cancel").onClick(()=>this.close())),this.columnValueInput.focus()}onClose(){let{contentEl:t}=this;t.empty()}},T=class extends i.Modal{constructor(n,t,r){super(n),this.entries=t,this.onSubmit=r}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("bases-kanban-modal"),n.createEl("h3",{text:`Set property on ${this.entries.length} files`}),n.createEl("p",{text:"These files are missing the column property. Set a value to move them to a column.",cls:"setting-item-description"}),new i.Setting(n).setName("Property name").addText(t=>{this.propertyInput=t.inputEl,t.setPlaceholder("e.g. Status")}),new i.Setting(n).setName("Value").addText(t=>{this.valueInput=t.inputEl,t.setPlaceholder("e.g. Todo")}),new i.Setting(n).addButton(t=>t.setButtonText("Apply to all").setCta().onClick(()=>{let r=this.propertyInput.value.trim(),e=this.valueInput.value.trim();r&&e?(this.onSubmit(r,e),this.close()):new i.Notice("Please enter both property name and value")})).addButton(t=>t.setButtonText("Cancel").onClick(()=>this.close())),this.propertyInput.focus()}onClose(){let{contentEl:n}=this;n.empty()}};var L=require("obsidian"),w={},C=class extends L.PluginSettingTab{constructor(n,t){super(n,t),this.plugin=t}display(){let{containerEl:n}=this;n.empty(),n.createEl("p",{text:"Kanban view settings will appear here.",cls:"setting-item-description"})}};var E=class extends I.Plugin{async onload(){await this.loadSettings(),this.registerBasesView("kanban",{name:"Kanban",icon:"lucide-kanban",factory:(n,t)=>new b(n,t,this),options:()=>b.getViewOptions()}),this.addSettingTab(new C(this.app,this))}async loadSettings(){this.settings=Object.assign({},w,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}onunload(){}};
